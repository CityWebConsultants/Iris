<!DOCTYPE html>
<html>

<head>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <script src="//cdn.ckeditor.com/4.5.3/standard/ckeditor.js"></script>

  <script src="/admin/jsonform/deps/jquery.min.js"></script>
  <script src="/admin/jsonform/deps/underscore-min.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.ui.custom.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-dropdown.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-typeahead.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-tagsinput.min.js"></script>
  <script src="/admin/jsonform/deps/opt/spectrum.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.transloadit2.js"></script>

  <script src="/admin/jsonform/lib/jsonform.js"></script>

  <link rel="stylesheet" href="/admin/admin.css" />
  <script src="/admin/adminui.js"></script>

</head>


<body>

  <h1></h1>

  <form></form>


  <script>
    $(document).ready(function() {

      var type = document.location.pathname.split("/")[document.location.pathname.split("/").length - 1];

      $("h1").text("View for " + type);

      $.get(document.location.pathname + "/form").done(function(fields) {

        var schema = {
          "schema": {
            "title": {
              "type": "string",
              "title": "View name",
              "required": true
            },
            "conditions": {
              "type": "array",
              "items": {
                "type": "object",
                "title": "Conditions",
                "properties": {
                  "field": {
                    "type": "string",
                    "title": "Field to check",
                    "enum": fields
                  },
                  "wrapper": {
                    "type": "string",
                    "title": "Operator",
                    "enum": ["is", "in", "contains"]
                  },
                  "value": {
                    "type": "string",
                    "title": "Value to check for",
                    "description": "This value can be altered dynamically later on"
                  },
                }
              }
            },
            "fields": {
              "type": "array",
              "items": {
                "type": "object",
                "title": "Field",
                "properties": {
                  "field": {
                    "type": "string",
                    "title": "Entity field",
                    "enum": fields
                  },
                  "wrapper": {
                    "type": "string",
                    "title": "HTML wrapper element",
                    "enum": ["div", "span", "h1", "h2", "h3"]
                  },
                }
              }
            }
          }
        }

        schema.onSubmit = function(errors, values) {

          if (errors) {

            console.error(errors);

          } else {

            values.credentials = {
              "apikey": "letmein",
              "secretkey": "letmein"
            };

            $.post("/views/create/" + type, values, function(data, err) {

              //document.location.href = "/admin/views/" + type;

            })

          }
        };

        $('form').jsonForm(schema);

      })
    });

  </script>

</body>

</html>
