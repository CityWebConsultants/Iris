<!DOCTYPE html>
<html>

<head>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <script src="/admin/jsonform/deps/jquery.min.js"></script>
  <script src="/admin/jsonform/deps/underscore-min.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.ui.custom.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-dropdown.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-typeahead.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-tagsinput.min.js"></script>
  <script src="/admin/jsonform/deps/opt/spectrum.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.transloadit2.js"></script>

  <script src="/admin/jsonform/lib/jsonform.js"></script>

  <link rel="stylesheet" href="/admin/admin.css" />

</head>


<body>

  <h1></h1>

  <form></form>


  <script>
    $(document).ready(function() {

      $('form').jsonForm(schema);

    });

  </script>

  <script>
    var schema = {
      "schema": {
        "entityname": {
          "type": "string",
          "title": "Entity name",
          "description": "The name of this entity. This cannot be changed.",
          "required": true
        },
        "help": {
          "type": "hidden"
        },
        "text": {
          "type": "object",
          "title": "Text",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "fieldType": {
              "type": "string",
              "title": "Type of value",
              "enum": ["text", "number", "rich text"]
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "multifield": {
              "type": "boolean",
              "title": "Can this field have multiple entries?"
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
          }
        },
        "longtext": {
          "type": "object",
          "title": "Long text",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "fieldType": {
              "type": "string",
              "title": "Type of value",
              "enum": ["text", "number", "rich text"]
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "multifield": {
              "type": "boolean",
              "title": "Can this field have multiple entries?"
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
          }
        },
        "date": {
          "type": "object",
          "title": "Text",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "multifield": {
              "type": "boolean",
              "title": "Can this field have multiple entries?"
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
          }
        },
        "boolean": {
          "type": "object",
          "title": "Boolean",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            }
          }
        },
        "object": {
          "type": "object",
          "title": "Object",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "subfields": {

              "type": "array",
              "title": "subfield",
              "items": {

                type: "object",
                properties: {

                  "text": {
                    "type": "object",
                    "title": "Text",
                    "properties": {
                      "system name": {
                        "type": "string",
                        "title": "System name",
                        "description": "The name of the field when stored in the database (this can't be changed easily once set)",
                        "required": true
                      },
                      "label": {
                        "allowEmpty": true,
                        "type": "string",
                        "title": "Label"
                      },
                      "fieldType": {
                        "allowEmpty": true,
                        "type": "string",
                        "title": "Type of value",
                        "enum": ["text", "number", "rich text"]
                      },
                      "description": {
                        "allowEmpty": true,
                        "type": "textarea",
                        "title": "Description"
                      },
                      "multifield": {
                        "allowEmpty": true,
                        "type": "boolean",
                        "title": "Can this field have multiple entries?"
                      },
                      "required": {
                        "allowEmpty": true,
                        "type": "boolean",
                        "title": "Is this field required?"
                      },
                    }
                  }

                }

              }

            }
          }
        },
        "select": {
          "type": "object",
          "title": "options",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "options": {
              "type": "array",
              "title": "Options",
              "items": {
                "option": {
                  "type": "string",
                  "title": "option",
                }
              }
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            }
          }
        },
      },
      "form": [{
        "key": "entityname",
      }, {
        "type": "array",
        "title": "Fields",
        "items": {
          "type": "selectfieldset",
          "title": "Choose a field type",
          "onChange": function(evt) {
            var value = $(evt.target).val();
            var inputs = $(evt.target).closest("li").find("[name]");

            var number = $(evt.target).closest("li").index();

            $.each(inputs, function(index, element) {

              if ($(element).attr("name").indexOf("_") === -1) {

                $(element).attr("name", $(element).attr("name").replace(" ", "-"));

                $(element).attr("name", $(element).attr("name") + "_" + number);

              }

            });

          },
          "items": ["help", "text", "select", "boolean", "date"],
          "items": [{
            "key": "help",
            "legend": "Pick a field"
          }, {
            "key": "text",
            "legend": "A text field"
          }, {
            "key": "longtext",
            "legend": "A long text field"
          }, {
            "key": "select",
            "legend": "A select field"
          }, {
            "key": "boolean",
            "legend": "A yes/no checkbox"
          }, {
            "key": "date",
            "legend": "A date field"
          }, {
            "key": "object",
            "legend": "A field collection"
          }],
        }
      }, {
        "type": "submit",
        "title": "Submit"
      }],
      onSubmit: function(errors, values) {

        $.each($("*[name*='object.subfields']"), function(index, element) {

          var fieldnumber = $(element).attr("name").split(".")[1].replace("subfields[", "").replace("]", "");
          var fcnumber = $(element).attr("name").split("_")[1];

          $(element).attr("name", $(element).attr("name").replace("object.subfields[0].", fcnumber + "fc" + fieldnumber));

        });

        if (errors) {
          console.error(errors);
        } else {

          values.credentials = {
            "apikey": "letmein",
            "secretkey": "letmein"
          };

          var form = $('form').serializeArray();

          $.post("/schema/create", form, function(data, errors) {

            console.log(errors);

          });

        }
      }
    }

  </script>

</body>

</html>
