<!DOCTYPE html>
<html>

<head>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <script src="/admin/jsonform/deps/jquery.min.js"></script>
  <script src="/admin/jsonform/deps/underscore-min.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.ui.custom.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-dropdown.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-typeahead.js"></script>
  <script src="/admin/jsonform/deps/opt/bootstrap-tagsinput.min.js"></script>
  <script src="/admin/jsonform/deps/opt/spectrum.js"></script>
  <script src="/admin/jsonform/deps/opt/jquery.transloadit2.js"></script>

  <script src="/admin/jsonform/lib/jsonform.js"></script>

  <link rel="stylesheet" href="/admin/admin.css" />

</head>


<body>

  <h1></h1>

  <form></form>


  <script>
    $(document).ready(function() {

      $('form').jsonForm(schema);

    });

  </script>

  <script>
    var schema = {
      "schema": {
        "help": {
          "type": "hidden"
        },
        "text": {
          "type": "object",
          "title": "Text",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "fieldType": {
              "type": "string",
              "title": "Type of value",
              "enum": ["text", "number", "rich text"]
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "multifield": {
              "type": "boolean",
              "title": "Can this field have multiple entries?"
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
          }
        },
        "date": {
          "type": "object",
          "title": "Text",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "name": {
              "type": "string",
              "title": "Label"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            },
            "multifield": {
              "type": "boolean",
              "title": "Can this field have multiple entries?"
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
          }
        },
        "boolean": {
          "type": "object",
          "title": "Boolean",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "name": {
              "type": "string",
              "title": "Label"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            }
          }
        },
        "select": {
          "type": "object",
          "title": "options",
          "properties": {
            "system name": {
              "type": "string",
              "title": "System name",
              "description": "The name of the field when stored in the database (this can't be changed easily once set)",
              "required": true
            },
            "label": {
              "type": "string",
              "title": "Label"
            },
            "options": {
              "type": "array",
              "title": "Options",
              "items": {
                "option": {
                  "type": "string",
                  "title": "option",
                }
              }
            },
            "required": {
              "type": "boolean",
              "title": "Is this field required?"
            },
            "description": {
              "type": "textarea",
              "title": "Description"
            }
          }
        },
      },
      "form": [{
        "type": "array",
        "title": "Fields",
        "items": {
          "type": "selectfieldset",
          "title": "Choose a field type",
          "onChange": function(evt) {
            var value = $(evt.target).val();
            var inputs = $(evt.target).closest("li").find("[name]");

            var number = $(evt.target).closest("li").index();

            $.each(inputs, function(index, element) {

              if ($(element).attr("name").indexOf("_") === -1) {

                $(element).attr("name", $(element).attr("name").replace(" ", "-"));

                $(element).attr("name", $(element).attr("name") + "_" + number);

              }

            });

          },
          "items": ["help", "text", "select", "boolean", "date"],
          "items": [{
            "key": "help",
            "legend": "Pick a field"
          }, {
            "key": "text",
            "legend": "A text field"
          }, {
            "key": "select",
            "legend": "A select field"
          }, {
            "key": "boolean",
            "legend": "A yes/no checkbox"
          }, {
            "key": "date",
            "legend": "A date field"
          }],
        }
      }, {
        "type": "submit",
        "title": "Submit"
      }],
      onSubmit: function(errors, values) {

        if (errors) {
          console.error(errors);
        } else {

          values.credentials = {
            "apikey": "letmein",
            "secretkey": "letmein"
          };

          var form = $('form').serialize();

          $.post("/schema/create/test", form, function(data, errors) {

            console.log(errors);

          });

        }
      }
    }

  </script>

</body>

</html>
